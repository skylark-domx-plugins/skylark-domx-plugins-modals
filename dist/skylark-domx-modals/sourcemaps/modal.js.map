{"version":3,"sources":["modal.js"],"names":["define","langx","browser","eventer","noder","geom","$","plugins","modals","Modal","Plugin","inherit","klassName","pluginName","options","backdrop","keyboard","show","_construct","element","prototype","call","this","$container","container","document","body","$element","$dialog","find","is","css","$backdrop","isShown","originalBodyPad","scrollbarWidth","ignoreBackdropClick","remote","load","proxy","trigger","toggle","_relatedTarget","hide","that","e","create","relatedTarget","isDefaultPrevented","checkScrollbar","setScrollbar","addClass","escape","resize","on","one","target","transition","support","hasClass","isChildOf","appendTo","scrollTop","adjustDialog","offsetWidth","enforceFocus","emulateTransitionEnd","TRANSITION_DURATION","preventDefault","off","removeClass","hideModal","has","length","which","window","handleUpdate","resetAdjustments","resetScrollbar","removeBackdrop","remove","callback","animate","doAnimate","createElement","currentTarget","focus","BACKDROP_TRANSITION_DURATION","callbackRemove","modalIsOverflowing","scrollHeight","documentElement","clientHeight","paddingLeft","bodyIsOverflowing","paddingRight","fullWindowWidth","innerWidth","documentElementRect","getBoundingClientRect","right","Math","abs","left","clientWidth","measureScrollbar","bodyPad","parseInt","style","scrollDiv","className","append","removeChild","register"],"mappings":"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","file":"../modal.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-noder\",\r\n  \"skylark-domx-geom\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-plugins-base\",\r\n  \"./modals\"\r\n],function(langx,browser,eventer,noder,geom,$,plugins,modals){\r\n\r\n\r\n  'use strict';\r\n\r\n  // MODAL CLASS DEFINITION\r\n  // ======================\r\n\r\n  var Modal = plugins.Plugin.inherit({\r\n    klassName: \"Modal\",\r\n\r\n    pluginName : \"lark.modals.modal\",\r\n\r\n    options : {\r\n      backdrop: true,\r\n      keyboard: true,\r\n      show: true\r\n    },\r\n\r\n    _construct : function(element,options) {\r\n      plugins.Plugin.prototype._construct.call(this,element,options);\r\n\r\n      this.$container               = $(options.container || document.body)\r\n      this.$element            = $(element)\r\n      this.$dialog             = this.$element.find('.modal-dialog')\r\n      if (!this.$container.is(\"body\")) {\r\n        this.$element.css(\"position\",\"absolute\");\r\n      }\r\n      //this.$container.append(this.$element);\r\n      this.$backdrop           = null\r\n      this.isShown             = null\r\n      this.originalBodyPad     = null\r\n      this.scrollbarWidth      = 0\r\n      this.ignoreBackdropClick = false\r\n\r\n      if (this.options.remote) {\r\n        this.$element\r\n          .find('.modal-content')\r\n          .load(this.options.remote, langx.proxy(function () {\r\n            this.$element.trigger('loaded.modal')\r\n          }, this))\r\n      }\r\n\r\n      if (this.show) {\r\n        this.show();\r\n      }\r\n    },\r\n\r\n    toggle : function (_relatedTarget) {\r\n      return this.isShown ? this.hide() : this.show(_relatedTarget)\r\n    },\r\n\r\n    show : function (_relatedTarget) {\r\n      var that = this\r\n      var e    = eventer.create('show.modal', { relatedTarget: _relatedTarget })\r\n\r\n      this.$element.trigger(e)\r\n\r\n      if (this.isShown || e.isDefaultPrevented()) return\r\n\r\n      this.isShown = true\r\n\r\n      this.checkScrollbar()\r\n      this.setScrollbar()\r\n      this.$container.addClass('modal-open')\r\n\r\n      this.escape()\r\n      this.resize()\r\n\r\n      this.$element.on('click.dismiss.modal', '[data-dismiss=\"modal\"]', langx.proxy(this.hide, this))\r\n\r\n      this.$dialog.on('mousedown.dismiss.modal', function () {\r\n        that.$element.one('mouseup.dismiss.modal', function (e) {\r\n          if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true\r\n        })\r\n      })\r\n\r\n      this.backdrop(function () {\r\n        var transition = browser.support.transition && that.$element.hasClass('fade')\r\n\r\n        if (!noder.isChildOf(that.$element[0],that.$container[0])) {\r\n          that.$element.appendTo(that.$container) // don't move modals dom position\r\n        }\r\n\r\n        that.$element\r\n          .show()\r\n          .scrollTop(0)\r\n\r\n        that.adjustDialog()\r\n\r\n        if (transition) {\r\n          that.$element[0].offsetWidth // force reflow\r\n        }\r\n\r\n        that.$element.addClass('in')\r\n\r\n        that.enforceFocus()\r\n\r\n        var e = eventer.create('shown.modal', { relatedTarget: _relatedTarget })\r\n\r\n        transition ?\r\n          that.$dialog // wait for modal to slide in\r\n            .one('transitionEnd', function () {\r\n              that.$element.trigger('focus').trigger(e)\r\n            })\r\n            .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\r\n          that.$element.trigger('focus').trigger(e)\r\n      })\r\n    },\r\n\r\n    hide : function (e) {\r\n      if (e) e.preventDefault()\r\n\r\n      e = eventer.create('hide.modal')\r\n\r\n      this.$element.trigger(e)\r\n\r\n      if (!this.isShown || e.isDefaultPrevented()) return\r\n\r\n      this.isShown = false\r\n\r\n      this.escape()\r\n      this.resize()\r\n\r\n      $(document).off('focusin.modal')\r\n\r\n      this.$element\r\n        .removeClass('in')\r\n        .off('click.dismiss.modal')\r\n        .off('mouseup.dismiss.modal')\r\n\r\n      this.$dialog.off('mousedown.dismiss.modal')\r\n\r\n      browser.support.transition && this.$element.hasClass('fade') ?\r\n        this.$element\r\n          .one('transitionEnd', langx.proxy(this.hideModal, this))\r\n          .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\r\n        this.hideModal()\r\n    },\r\n\r\n    enforceFocus : function () {\r\n      $(document)\r\n        .off('focusin.modal') // guard against infinite focus loop\r\n        .on('focusin.modal', langx.proxy(function (e) {\r\n          if (document !== e.target &&\r\n              this.$element[0] !== e.target &&\r\n              !this.$element.has(e.target).length) {\r\n            this.$element.trigger('focus')\r\n          }\r\n        }, this))\r\n    },\r\n\r\n    escape : function () {\r\n      if (this.isShown && this.options.keyboard) {\r\n        this.$element.on('keydown.dismiss.modal', langx.proxy(function (e) {\r\n          e.which == 27 && this.hide()\r\n        }, this))\r\n      } else if (!this.isShown) {\r\n        this.$element.off('keydown.dismiss.modal')\r\n      }\r\n    },\r\n\r\n    resize : function () {\r\n      if (this.isShown) {\r\n        $(window).on('resize.modal', langx.proxy(this.handleUpdate, this))\r\n      } else {\r\n        $(window).off('resize.modal')\r\n      }\r\n    },\r\n\r\n    hideModal : function () {\r\n      var that = this\r\n      this.$element.hide()\r\n      this.backdrop(function () {\r\n        that.$container.removeClass('modal-open')\r\n        that.resetAdjustments()\r\n        that.resetScrollbar()\r\n        that.$element.trigger('hidden.modal')\r\n      })\r\n    },\r\n\r\n    removeBackdrop : function () {\r\n      this.$backdrop && this.$backdrop.remove()\r\n      this.$backdrop = null\r\n    },\r\n\r\n    backdrop : function (callback) {\r\n      var that = this\r\n      var animate = this.$element.hasClass('fade') ? 'fade' : ''\r\n\r\n      if (this.isShown && this.options.backdrop) {\r\n        var doAnimate = browser.support.transition && animate\r\n\r\n        this.$backdrop = $(document.createElement('div'))\r\n          .addClass('modal-backdrop ' + animate)\r\n          .appendTo(this.$container)\r\n\r\n        if (!this.$container.is(\"body\")) {\r\n          this.$backdrop.css(\"position\",\"absolute\");\r\n        }\r\n\r\n\r\n        this.$element.on('click.dismiss.modal', langx.proxy(function (e) {\r\n          if (this.ignoreBackdropClick) {\r\n            this.ignoreBackdropClick = false\r\n            return\r\n          }\r\n          if (e.target !== e.currentTarget) return\r\n          this.options.backdrop == 'static'\r\n            ? this.$element[0].focus()\r\n            : this.hide()\r\n        }, this))\r\n\r\n        if (doAnimate) this.$backdrop[0].offsetWidth // force reflow\r\n\r\n        this.$backdrop.addClass('in')\r\n\r\n        if (!callback) return\r\n\r\n        doAnimate ?\r\n          this.$backdrop\r\n            .one('transitionEnd', callback)\r\n            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\r\n          callback()\r\n\r\n      } else if (!this.isShown && this.$backdrop) {\r\n        this.$backdrop.removeClass('in')\r\n\r\n        var callbackRemove = function () {\r\n          that.removeBackdrop()\r\n          callback && callback()\r\n        }\r\n        browser.support.transition && this.$element.hasClass('fade') ?\r\n          this.$backdrop\r\n            .one('transitionEnd', callbackRemove)\r\n            .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\r\n          callbackRemove()\r\n\r\n      } else if (callback) {\r\n        callback()\r\n      }\r\n    },\r\n\r\n    // these following methods are used to handle overflowing modals\r\n\r\n    handleUpdate : function () {\r\n      this.adjustDialog()\r\n    },\r\n\r\n    adjustDialog : function () {\r\n      var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight\r\n\r\n      this.$element.css({\r\n        paddingLeft:  !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',\r\n        paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''\r\n      })\r\n    },\r\n\r\n    resetAdjustments : function () {\r\n      this.$element.css({\r\n        paddingLeft: '',\r\n        paddingRight: ''\r\n      })\r\n    },\r\n\r\n    checkScrollbar : function () {\r\n      var fullWindowWidth = window.innerWidth\r\n      if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8\r\n        var documentElementRect = document.documentElement.getBoundingClientRect()\r\n        fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)\r\n      }\r\n      this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth\r\n      this.scrollbarWidth = this.measureScrollbar()\r\n    },\r\n\r\n    setScrollbar : function () {\r\n      var bodyPad = parseInt((this.$container.css('padding-right') || 0), 10)\r\n      this.originalBodyPad = document.body.style.paddingRight || ''\r\n      if (this.bodyIsOverflowing) this.$container.css('padding-right', bodyPad + this.scrollbarWidth)\r\n    },\r\n\r\n    resetScrollbar : function () {\r\n      this.$container.css('padding-right', this.originalBodyPad)\r\n    },\r\n\r\n    measureScrollbar : function () { // thx walsh\r\n      var scrollDiv = document.createElement('div')\r\n      scrollDiv.className = 'modal-scrollbar-measure'\r\n      this.$container.append(scrollDiv)\r\n      var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth\r\n      this.$container[0].removeChild(scrollDiv)\r\n      return scrollbarWidth\r\n    }\r\n\r\n  });  \r\n\r\n\r\n  Modal.TRANSITION_DURATION = 300\r\n  Modal.BACKDROP_TRANSITION_DURATION = 150\r\n\r\n  plugins.register(Modal);\r\n\r\n\r\n  return modals.Modal = Modal;\r\n\r\n});\r\n"]}